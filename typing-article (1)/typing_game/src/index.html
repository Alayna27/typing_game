<!DOCTYPE html>
<script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js></script>
             
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Typing Game - Classical Literature</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f9;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .quote {
      font-size: 1.1em;
      margin-bottom: 20px;
      color: #333;
      white-space: pre-wrap;
    }
    #inputArea {
      width: 100%;
      padding: 10px;
      font-size: 1em;
    }
    #result {
      margin-top: 20px;
    }
    .word-list {
      margin-top: 10px;
      padding: 10px;
      background: #eee;
      border-radius: 5px;
    }
    .definition {
      margin-left: 15px;
      font-size: 0.95em;
      color: #555;
    }
    #imageContainer {
      margin: 20px 0;
      text-align: center;
    }
    #imageContainer img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
    }
    #startBtn, #nextBtn {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      background-color: #007BFF;
      color: white;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Typing Practice Game</h2>
    <div id="levelSelector">
      <label>Select Level:</label>
      <select id="difficulty">
        <option value="beginner">Beginner</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>
      <button id="startBtn">Start</button>
    </div>
    <div id="gameArea" style="display: none;">
      <p class="quote" id="quoteText"></p>
      <div id="imageContainer"></div>
      <textarea id="inputArea" rows="12" placeholder="Start typing here..."></textarea>
      <div id="result"></div>
    </div>
  </div>

  <script>
    const passages = {
      beginner: [
        {
          text: `A lion lay asleep in the forest, his great head resting on his paws. A little mouse came upon him unexpectedly and in her fright and haste to get away, ran across the lion’s nose.`,
          image: 'https://upload.wikimedia.org/wikipedia/commons/0/09/The_Lion_and_the_Mouse_-_Project_Gutenberg_etext_19994.jpg'
        },
        {
          text: `The sun shone down for nearly a week on the secret garden. The secret garden was what Mary called it when she was thinking of it.`,
          image: 'https://upload.wikimedia.org/wikipedia/commons/4/4b/The_Secret_Garden_-_Frances_Hodgson_Burnett_-_1st_ed.djvu'
        },
        {
          text: `Alice was beginning to get very tired of sitting by her sister on the bank, and of having nothing to do.`,
          image: 'https://upload.wikimedia.org/wikipedia/commons/2/25/Alice_in_Wonderland.jpg'
        }
      ],
      medium: [
        {
          text: `It’s delightful when your imaginations come true, isn’t it? But they nearly always don’t. That’s just the trouble with life.`,
          image: 'https://upload.wikimedia.org/wikipedia/commons/b/bc/Anne_of_Green_Gables_bookcover.jpg'
        },
        {
          text: `I remember him as if it were yesterday, as he came plodding to the inn door, his sea-chest following behind him in a hand-barrow.`,
          image: 'https://upload.wikimedia.org/wikipedia/commons/9/9b/Treasure_Island_-_illustration_by_N._C._Wyeth.jpg'
        },
        {
          text: `It is a truth universally acknowledged, that a single man in possession of a good fortune, must be in want of a wife.`,
          image: 'https://upload.wikimedia.org/wikipedia/commons/1/1e/PrideAndPrejudiceTitlePage.jpg'
        }
      ],
      high: [
        {
          text: `Call me Ishmael. Some years ago—never mind how long precisely—having little or no money in my purse, I thought I would sail about a little and see the watery part of the world.`,
          image: 'https://upload.wikimedia.org/wikipedia/commons/5/58/Moby-Dick_FE_title_page.jpg'
        },
        {
          text: `I had worked hard for nearly two years, for the sole purpose of infusing life into an inanimate body. But now that I had finished, the beauty of the dream vanished.`,
          image: 'https://upload.wikimedia.org/wikipedia/commons/b/b8/Frankenstein_1831_Cover.jpg'
        },
        {
          text: `Whatever our souls are made of, his and mine are the same.`,
          image: 'https://upload.wikimedia.org/wikipedia/commons/0/08/Wuthering_Heights_first_edition_title_page.jpg'
        }
      ]
    };

    let currentLevel = "beginner";
    let quoteIndex = 0;
    let hasStarted = false;
    let startTime = null;
    let selectedQuote = "";

    const quoteElement = document.getElementById("quoteText");
    const inputArea = document.getElementById("inputArea");
    const resultElement = document.getElementById("result");
    const imageContainer = document.getElementById("imageContainer");
    const gameArea = document.getElementById("gameArea");
    const startBtn = document.getElementById("startBtn");

    function selectQuote() {
      const quotes = passages[currentLevel];
      if (quoteIndex >= quotes.length) quoteIndex = 0;
      selectedQuote = quotes[quoteIndex].text;
      quoteElement.textContent = selectedQuote;
      imageContainer.innerHTML = `<img src="${quotes[quoteIndex].image}" alt="passage image" />`;
      inputArea.value = "";
      resultElement.innerHTML = "";
      inputArea.disabled = false;
      inputArea.focus();
      hasStarted = false;
      startTime = null;
    }

    function calculateScore(timeTaken) {
      if (timeTaken < 60) return 100;
      if (timeTaken < 70) return 90;
      if (timeTaken < 80) return 80;
      if (timeTaken < 90) return 70;
      if (timeTaken < 100) return 60;
      if (timeTaken < 120) return 50;
      return 30;
    }

    function getWordList(text) {
      return [...new Set(text.toLowerCase().match(/\b[a-z]+\b/g))];
    }

    async function fetchDefinition(word) {
      const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
      if (response.ok) {
        const data = await response.json();
        if (data[0]?.meanings?.[0]?.definitions?.[0]?.definition) {
          return data[0].meanings[0].definitions[0].definition;
        }
      }
      return "(Definition not found)";
    }

    async function displayResults(timeTaken, score, wordList) {
      let wordHtml = '<ul>';
      for (let word of wordList) {
        const definition = await fetchDefinition(word);
        wordHtml += `<li><strong>${word}</strong><div class="definition">${definition}</div></li>`;
      }
      wordHtml += '</ul>';

      resultElement.innerHTML = `
        <p>Time taken: ${timeTaken.toFixed(2)} seconds</p>
        <p>Your score: ${score}</p>
        <div class="word-list">
          <strong>Word list with definitions:</strong><br />
          ${wordHtml}
        </div>
        <button id="nextBtn">Next Passage</button>
      `;

      document.getElementById("nextBtn").addEventListener("click", () => {
        quoteIndex++;
        selectQuote();
      });
    }

    inputArea.addEventListener("keydown", () => {
      if (!hasStarted) {
        hasStarted = true;
        startTime = new Date();
      }
    });

    inputArea.addEventListener("input", async () => {
      if (inputArea.value.trim() === selectedQuote) {
        const endTime = new Date();
        const timeTaken = (endTime - startTime) / 1000;
        const score = calculateScore(timeTaken);
        const wordList = getWordList(selectedQuote);

        inputArea.disabled = true;
        await displayResults(timeTaken, score, wordList);
      }
    });

    startBtn.addEventListener("click", () => {
      currentLevel = document.getElementById("difficulty").value;
      quoteIndex = 0;
      document.getElementById("levelSelector").style.display = "none";
      gameArea.style.display = "block";
      selectQuote();
    });

    window.onload = () => {
      inputArea.disabled = true;
    };
  </script>
</body>
</html>